@using System.Net;
@using ShomreiTorah.Statements;
@using ShomreiTorah.Statements.Email;
@inherits StatementPage
@{
    EmailSubject = "Shomrei Torah Receipt";
    Kind = StatementKind.Receipt;
    _Layout = "_StatementLayout";
}
@section Title {
    Congregation Shomrei Torah<br />
    @Info.StartDate.Year
Contributions Summary
}
<table cellspacing="0" width="100%">
    <tr>
        <td style="padding-top: 15px;">
            @Raw(WebUtility.HtmlEncode(Info.Person.MailingAddress).Replace(Environment.NewLine, "<br />"))
        </td>
        <td style="padding-top: 15px; width: 250px; vertical-align: top;">
            @DateTime.Today.ToLongDateString()</td>
    </tr>
</table>
<p>
    Dear @Info.Person.FullName,</p>
<p>
    On behalf of Rabbi Weinberger and Congregation Shomrei Torah of Passaic Clifton,
    I would like to express my sincere gratitude and appreciation for your generous
    @(Info.Accounts.Sum(a => a.Payments.Count) == 1 ? "contribution" : "contributions")
    to our Shul.
</p>
<p>
    Below is your
    @Info.StartDate.Year
    annual contributions summary. If you have any questions, please reply to this email
    or call Levi Krinsky at (973) 594 - 7972.</p>
<p>
    May your support of our Shul bring you ברכה and הצלחה in all of your endeavors.
</p>
<p>
    @Info.Deductibility</p>
<table cellspacing="0" style="margin: 0 auto;">
    @foreach (var account in Info.Accounts) {
        <thead>
            <tr>
                <th colspan="3" style="font-size: large; text-align: center; padding: 25px 0 7px 0;
                    border-bottom: solid 2px black;">@account.AccountName</th>
            </tr>
        </thead>
        const string StripeStyle = "background: #E8EBFF;";
        string curStyle = "";

        foreach (var payment in account.Payments) {
            curStyle = curStyle == "" ? StripeStyle : "";
        <tr>
            <td style="padding-right: 8px; @curStyle">@payment.Date.ToShortDateString()</td>
            <td style="@curStyle">
                @payment.Method.Replace("Unknown", "?")
                @if (!String.IsNullOrEmpty(payment.CheckNumber)) {
                    <text>#@payment.CheckNumber</text>
                }
            </td>
            <td style="text-align: right; @curStyle">@payment.Amount.ToString("c")</td>
        </tr>
        }
        <tr>
            <td colspan="2" style="border-top: solid 1px black; border-bottom: solid 2px black;
                padding-top: 10px;">Total:</td>
            <td style="text-align: right; font-weight: bold; border-top: solid 1px black; border-bottom: solid 2px black;
                padding-top: 10px;">@account.TotalPaid.ToString("c")</td>
        </tr>
    }
</table>
<p>
    Sincerely,</p>
<p>
    Levi Krinsky<br />
    @Image("LeviKrinsky.png", "Levi Krinsky's Sugnature")<br />
    Treasurer
</p>