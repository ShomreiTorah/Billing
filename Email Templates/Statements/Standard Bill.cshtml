@using ShomreiTorah.Statements;
@using ShomreiTorah.Statements.Email;
@using System.Net;
@inherits StatementPage
@{
    EmailSubject = "K'hal Tiferes Boruch Bill";
    Kind = StatementKind.Bill;
    _Layout = "_StatementLayout";
}
@section Title {
    K'hal Tiferes Boruch<br />
Billing Statement
}
<table cellspacing="0" width="100%">
    <tr>
        <td style="padding-top: 15px;">
            @Raw(WebUtility.HtmlEncode(Info.Person.MailingAddress).Replace(Environment.NewLine, "<br />"))
        </td>
        <td style="padding-top: 15px; width: 250px; vertical-align: top;">
            @DateTime.Today.ToLongDateString() </td>
    </tr>
</table>
<p>
    Dear @Info.Person.FullName,</p>
<p>
    On behalf of Rabbi Weinberger and K'hal Tiferes Boruch, I would like to express
    my sincere gratitude and appreciation for your financial support and valued participation
    in our davening and learning. Through your generosity, support, and participation
    our Shul will continue to grow and thrive as a special place of Torah and Avodah.</p>
<p>
    Your total balance due is <b>@Info.TotalBalance.ToString("c")</b>. Please review
    the summary below. If you have any questions regarding the pledges or payments contained
    herein, please reply to this email or contact Levi Krinsky at (973) 594 - 7972.
</p>
<p>
    Thank you.</p>
@{
    const string StripeStyle = "background: #E8EBFF;";
    string curStyle = "";
}
<table cellspacing="0" style="margin: 0 auto;">
    @foreach (var account in Info.Accounts) {
        <tr>
            <th colspan="3" style="padding-top: 25px; border-bottom: solid 2px black;">
                @account.AccountName Pledges</th>
        </tr>
        <tr>
            <td colspan="2" style="padding-bottom: 7px;">Starting Balance (as of
                @Info.StartDate.ToShortDateString()): </td>
            <td style="text-align: right; padding-bottom: 7px;">
                @account.OutstandingBalance.ToString("c")</td>
        </tr>

        curStyle = "";
        foreach (var pledge in account.Pledges) {
            curStyle = curStyle == "" ? StripeStyle : "";
        <tr>
            <td style="padding-right: 8px; @curStyle">@pledge.Date.ToShortDateString()</td>
            <td style="@curStyle">
                @(pledge.Type + (String.IsNullOrEmpty(pledge.SubType) ? "" : ", " + pledge.SubType))
                @if (!String.IsNullOrEmpty(pledge.Note)) {
                    <div style="font-style: italic;">@pledge.Note</div>
                }
            </td>
            <td style="text-align: right; @curStyle">@pledge.Amount.ToString("c")</td>
        </tr>
        }
        <tr>
            <td colspan="2" style="border-top: solid 1px black; border-bottom: solid 2px black;
                padding-top: 10px;">Total: </td>
            <td style="text-align: right; font-weight: bold; border-top: solid 1px black; border-bottom: solid 2px black;
                padding-top: 10px;">
                @account.TotalPledged.ToString("c")
            </td>
        </tr>
        <tr>
            <th colspan="3" style="padding-top: 25px; border-bottom: solid 2px black;">
                @account.AccountName Payments </th>
        </tr>
        <tr>
            <td colspan="3"><i>As of @Info.LastEnteredPayment.ToLongDateString()</i></td>
        </tr>
        curStyle = "";
        foreach (var payment in account.Payments) {
            curStyle = curStyle == "" ? StripeStyle : "";
        <tr>
            <td style="padding-right: 8px; @curStyle">
                @payment.Date.ToShortDateString()</td>
            <td style="@curStyle">
                @payment.Method.Replace("Unknown", "?")
                @if (!String.IsNullOrEmpty(payment.CheckNumber)) {
                    <text>#@payment.CheckNumber</text>
                }
            </td>
            <td style="text-align: right; @curStyle">
                @payment.Amount.ToString("c")</td>
        </tr>
        }
        if (account.Payments.Count == 0) {
        <tr>
            <td colspan="3">You have no @account.AccountName.ToLower() payments on record after
                @Info.StartDate.ToLongDateString() </td>
        </tr>
        } else {
        <tr>
            <td colspan="2" style="border-top: solid 1px black; border-bottom: solid 2px black;
                padding-top: 10px;">Total: </td>
            <td style="text-align: right; font-weight: bold; border-top: solid 1px black; border-bottom: solid 2px black;
                padding-top: 10px;">
                @account.TotalPaid.ToString("c")</td>
        </tr>
        }
    }
    <tr>
        <td colspan="2" style="padding-top: 15px">Total Pledged:</td>
        <td style="padding-top: 15px; text-align: right;">
            @Info.TotalPledged.ToString("c") </td>
    </tr>
    <tr>
        <td colspan="2">Total Paid:</td>
        <td style="text-align: right;">- @Info.TotalPaid.ToString("c")</td>
    </tr>
    <tr>
        <td colspan="2" style="padding-top: 5px; border-top: solid 1px black; border-bottom: solid 2px black;">
            Balance due: </td>
        <td style="padding-top: 5px; text-align: right; border-top: solid 1px black; border-bottom: solid 2px black;">
            <b>
                @Info.TotalBalance.ToString("c")</b></td>
    </tr>
</table>
@if (Info.TotalBalance > 0) {
    <p>
        Please make your checks payable to <b>Congregation Shomrei Torah of Passaic-Clifton</b>,
        and mail your remittance to:</p>
    <blockquote>
        <p>
            K'hal Tiferes Boruch<br />
            1360 Clifton Ave. # 908<br />
            Clifton, NJ 07012</p>
    </blockquote>
}
<p>
    Sincerely,</p>
<p>
    Levi Krinsky<br />
    @Image("LeviKrinsky.png", "Levi Krinsky's Sugnature")<br />
    Treasurer
</p>